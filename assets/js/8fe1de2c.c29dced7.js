"use strict";(globalThis.webpackChunktboh_doc=globalThis.webpackChunktboh_doc||[]).push([[9783],{4480:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"guia-inicio/instalacion","title":"Instalacion","description":"Backend (.NET + SQL Server)","source":"@site/docs/guia-inicio/instalacion.md","sourceDirName":"guia-inicio","slug":"/guia-inicio/instalacion","permalink":"/docs/guia-inicio/instalacion","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"Instalacion","title":"Instalacion","hide_title":false},"sidebar":"tutorialSidebar","previous":{"title":"Requisitos previos","permalink":"/docs/introduction/requisitos-previos"},"next":{"title":"Configuraci\xf3n Inicial","permalink":"/docs/guia-inicio/configuracion-inicial"}}');var r=s(4848),d=s(8453);const l={sidebar_position:1,sidebar_label:"Instalacion",title:"Instalacion",hide_title:!1},c=void 0,a={},o=[{value:"Backend (.NET + SQL Server)",id:"backend-net--sql-server",level:2},{value:"Requisitos",id:"requisitos",level:3},{value:"Variables de entorno",id:"variables-de-entorno",level:3},{value:"Pasos",id:"pasos",level:3},{value:"Jobs (Azure Functions)",id:"jobs-azure-functions",level:3},{value:"Frontend (Astro + React)",id:"frontend-astro--react",level:2},{value:"Requisitos",id:"requisitos-1",level:3},{value:"Variables de entorno",id:"variables-de-entorno-1",level:3},{value:"Pasos",id:"pasos-1",level:3}];function t(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"backend-net--sql-server",children:"Backend (.NET + SQL Server)"}),"\n",(0,r.jsx)(n.h3,{id:"requisitos",children:"Requisitos"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:".NET 8 SDK."}),"\n",(0,r.jsxs)(n.li,{children:["Instancia de SQL Server (local o Azure) con el esquema ",(0,r.jsx)(n.code,{children:"tboh-database.sql"})," aplicado."]}),"\n",(0,r.jsxs)(n.li,{children:["Variables de entorno: ",(0,r.jsx)(n.code,{children:"DbConnectionString"})," para la API y ",(0,r.jsx)(n.code,{children:"DefaultConnection"})," para los jobs."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"variables-de-entorno",children:"Variables de entorno"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Variable"}),(0,r.jsx)(n.th,{children:"Servicio"}),(0,r.jsx)(n.th,{children:"Descripcion"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"DbConnectionString"})}),(0,r.jsxs)(n.td,{children:["API (",(0,r.jsx)(n.code,{children:"tboh-backend"}),")"]}),(0,r.jsxs)(n.td,{children:["Cadena completa de SQL Server usada por Entity Framework. Puede declararse en ",(0,r.jsx)(n.code,{children:"appsettings.json"})," o como variable de ambiente y apunta a la base ",(0,r.jsx)(n.code,{children:"tboh-db-*"}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"TokenJwtKey"})}),(0,r.jsx)(n.td,{children:"API"}),(0,r.jsxs)(n.td,{children:["Clave simetrica usada para firmar los JWT entregados en ",(0,r.jsx)(n.code,{children:"/api/Login"}),". Cambiala por una cadena segura y mantenla en secreto."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"TokenExpirationMinutes"})}),(0,r.jsx)(n.td,{children:"API"}),(0,r.jsxs)(n.td,{children:["Minutos que permanecera valido el JWT emitido (ej. ",(0,r.jsx)(n.code,{children:"43200"})," = 30 dias)."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"BaseRespondentUrl"})}),(0,r.jsx)(n.td,{children:"API"}),(0,r.jsx)(n.td,{children:"URL publica base usada para construir enlaces de encuestas para los encuestados."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"JobManualUrl"})}),(0,r.jsx)(n.td,{children:"API"}),(0,r.jsxs)(n.td,{children:["Endpoint del Azure Function ",(0,r.jsx)(n.code,{children:"SurveyRulesHttpTrigger"})," usado cuando se fuerza la republicacion de reglas desde la API."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Twilio:AccountSid"})}),(0,r.jsx)(n.td,{children:"API"}),(0,r.jsx)(n.td,{children:"SID de la cuenta Twilio que envia los OTP de recuperacion."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Twilio:AuthToken"})}),(0,r.jsx)(n.td,{children:"API"}),(0,r.jsx)(n.td,{children:"Token secreto Twilio para autorizar el envio."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Twilio:ServiceSid"})}),(0,r.jsx)(n.td,{children:"API"}),(0,r.jsx)(n.td,{children:"SID del servicio de verificacion/OTP configurado en Twilio."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Twilio:OtpMaxAttempts"})}),(0,r.jsx)(n.td,{children:"API"}),(0,r.jsx)(n.td,{children:"Numero maximo de intentos permitidos al validar un OTP."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"DefaultConnection"})}),(0,r.jsxs)(n.td,{children:["Jobs (",(0,r.jsx)(n.code,{children:"tboh-jobs"}),")"]}),(0,r.jsx)(n.td,{children:"Cadena de conexion que consumen las Azure Functions para recalcular estados. Debe apuntar a la misma base que la API."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"AzureWebJobsStorage"})}),(0,r.jsx)(n.td,{children:"Jobs"}),(0,r.jsxs)(n.td,{children:["Storage account usada por Functions (en local puede ser ",(0,r.jsx)(n.code,{children:"UseDevelopmentStorage=true"}),")."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"FUNCTIONS_WORKER_RUNTIME"})}),(0,r.jsx)(n.td,{children:"Jobs"}),(0,r.jsxs)(n.td,{children:["Debe permanecer como ",(0,r.jsx)(n.code,{children:"dotnet-isolated"}),"."]})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"pasos",children:"Pasos"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Clona el repositorio y ubicate en ",(0,r.jsx)(n.code,{children:"tboh-backend"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Restaura paquetes y compila:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"dotnet restore\ndotnet build\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Configura las variables anteriores como secretos del entorno (o en ",(0,r.jsx)(n.code,{children:"appsettings.json"})," si es dev)."]}),"\n",(0,r.jsxs)(n.li,{children:["Ejecuta las migraciones o aplica el script ",(0,r.jsx)(n.code,{children:"tboh-database.sql"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Inicia la API:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"dotnet run\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["(Opcional) Construye la imagen Docker:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'docker build -t tboh-backend .\ndocker run -p 5000:8080 --env DbConnectionString="..." tboh-backend\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"jobs-azure-functions",children:"Jobs (Azure Functions)"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Ve a ",(0,r.jsx)(n.code,{children:"tboh-jobs/tboh-jobs"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Ajusta ",(0,r.jsx)(n.code,{children:"local.settings.json"})," con ",(0,r.jsx)(n.code,{children:"DefaultConnection"}),", ",(0,r.jsx)(n.code,{children:"AzureWebJobsStorage"})," y cualquier secreto adicional."]}),"\n",(0,r.jsxs)(n.li,{children:["Compila y ejecuta localmente:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"func start\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Publica en Azure Functions cuando este listo:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"func azure functionapp publish <nombre-funcion>\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"frontend-astro--react",children:"Frontend (Astro + React)"}),"\n",(0,r.jsx)(n.h3,{id:"requisitos-1",children:"Requisitos"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Node.js 20+."}),"\n",(0,r.jsxs)(n.li,{children:["PNPM o npm (el proyecto incluye ",(0,r.jsx)(n.code,{children:"pnpm-lock.yaml"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Variables ",(0,r.jsx)(n.code,{children:".env"})," con la URL del backend y claves de Auth (ejemplo en ",(0,r.jsx)(n.code,{children:".env.template"}),")."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"variables-de-entorno-1",children:"Variables de entorno"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Variable"}),(0,r.jsx)(n.th,{children:"Descripcion"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"AUTH_SECRET"})}),(0,r.jsxs)(n.td,{children:["Clave utilizada por ",(0,r.jsx)(n.code,{children:"auth-astro"})," para firmar y validar sesiones. Debe ser una cadena aleatoria de al menos 32 caracteres."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"AUTH_TRUST_HOST"})}),(0,r.jsxs)(n.td,{children:["Define si se confia en la cabecera ",(0,r.jsx)(n.code,{children:"Host"})," (usa ",(0,r.jsx)(n.code,{children:"true"})," cuando despliegas detras de proxies)."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"BACKEND_URL"})}),(0,r.jsxs)(n.td,{children:["URL base (",(0,r.jsx)(n.a,{href:"https://api.midominio.com",children:"https://api.midominio.com"}),") que consume el frontend para llamar a la API .NET."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"PUBLIC_EXCEL_TEMPLATE"})}),(0,r.jsx)(n.td,{children:"URL publica al archivo Excel que sirve como plantilla para cargar encuestados (se usa en el modulo de subida manual)."})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"pasos-1",children:"Pasos"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Entra a ",(0,r.jsx)(n.code,{children:"tboh-frontend"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Instala dependencias:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pnpm install\n# o\nnpm install\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Copia ",(0,r.jsx)(n.code,{children:".env.template"})," a ",(0,r.jsx)(n.code,{children:".env"})," y configura las variables anteriores."]}),"\n",(0,r.jsxs)(n.li,{children:["Levanta el servidor de desarrollo:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pnpm dev\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Construye y sirve en produccion:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pnpm build\npnpm preview\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Uso con Docker:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pnpm run docker:build\npnpm run docker:run   # expone el puerto 4321\n"})}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>c});var i=s(6540);const r={},d=i.createContext(r);function l(e){const n=i.useContext(d);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(d.Provider,{value:n},e.children)}}}]);